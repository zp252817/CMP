<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KMPå·¥ç¨‹é›†æˆé¸¿è’™åº”ç”¨å®Œæ•´æ•™ç¨‹</title>
  <style>
    :root {
      --bg: #f6f8f7;
      --card: #ffffff;
      --ink: #10231c;
      --muted: #4f6d66;
      --accent: #0f7668;
      --line: #d5e2de;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: "PingFang SC", "Noto Sans SC", sans-serif; background: var(--bg); color: var(--ink); }
    .wrap { max-width: 980px; margin: 0 auto; padding: 24px 18px 42px; }
    .top { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 12px; }
    .back { color: var(--accent); text-decoration: none; font-size: 14px; }
    h1 { margin: 0 0 8px; font-size: 30px; }
    .meta { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
    .chip { background: #dff1ec; color: var(--accent); border-radius: 999px; padding: 4px 10px; font-size: 12px; }
    .section { background: var(--card); border: 1px solid var(--line); border-radius: 14px; padding: 14px; margin-top: 12px; box-shadow: 0 8px 24px rgba(16,35,28,.05); }
    .section-head { display: flex; justify-content: space-between; gap: 10px; align-items: baseline; }
    .section-head h2 { margin: 0; font-size: 20px; }
    .section-head span { color: var(--accent); font-size: 13px; }
    .summary { color: #48665f; margin: 8px 0; font-size: 15px; line-height: 1.65; }
    .points { margin: 0 0 8px; padding-left: 18px; color: #48665f; }
    .points li { line-height: 1.65; }
    .content { margin: 0; background: linear-gradient(180deg, #fbfefe 0%, #f7fbfa 100%); border: 1px solid var(--line); border-radius: 12px; padding: 14px; line-height: 1.7; font-size: 16px; color: #173029; }
    .content h1, .content h2, .content h3, .content h4 { margin: 14px 0 8px; line-height: 1.35; color: #0f3028; }
    .content h1:first-child, .content h2:first-child, .content h3:first-child, .content h4:first-child { margin-top: 0; }
    .content h2 { font-size: 24px; font-weight: 750; }
    .content h3 { font-size: 20px; font-weight: 700; }
    .content h4 { font-size: 17px; font-weight: 680; color: #1b4b40; }
    .content .auto-h3 { border-left: 4px solid #78b6a7; padding-left: 10px; }
    .content .auto-h4 { color: #205145; }
    .content p { margin: 0 0 9px; color: #1e3b34; }
    .content p:last-child { margin-bottom: 0; }
    .content ul, .content ol { margin: 0 0 10px; padding-left: 20px; }
    .content li + li { margin-top: 6px; }
    .content.xmind-outline { background: linear-gradient(180deg, #f8fcfb 0%, #f2f8f6 100%); }
    .content.xmind-outline ul, .content.xmind-outline ol {
      list-style: none;
      margin: 8px 0 0 0;
      padding-left: 22px;
      border-left: 1px solid #c7ddd6;
    }
    .content.xmind-outline > ul, .content.xmind-outline > ol {
      border-left: none;
      padding-left: 0;
      margin-top: 0;
    }
    .content.xmind-outline li {
      position: relative;
      margin: 8px 0;
      padding: 6px 10px;
      background: #ffffff;
      border: 1px solid #d6e7e2;
      border-radius: 10px;
      box-shadow: 0 1px 0 rgba(15, 87, 74, 0.06);
    }
    .content.xmind-outline li::before {
      content: "";
      position: absolute;
      left: -22px;
      top: 50%;
      width: 22px;
      border-top: 1px solid #c7ddd6;
      transform: translateY(-50%);
    }
    .content.xmind-outline > ul > li::before,
    .content.xmind-outline > ol > li::before { display: none; }
    .content.xmind-outline li > ul,
    .content.xmind-outline li > ol { margin-top: 8px; }
    .content blockquote { margin: 10px 0; padding: 8px 12px; border-left: 3px solid #99c6bb; background: #edf7f4; color: #375852; border-radius: 6px; }
    .content hr { border: none; border-top: 1px dashed #b8d2cb; margin: 12px 0; }
    .content a { color: #0b6d61; text-decoration: none; border-bottom: 1px dashed rgba(11,109,97,.35); }
    .content a:hover { border-bottom-style: solid; }
    .content code { font-family: "SFMono-Regular", Menlo, Consolas, monospace; }
    .content :not(pre) > code { background: #e6f2ef; color: #0f5f54; border-radius: 6px; padding: 2px 6px; }
    .content pre { margin: 10px 0; white-space: pre; overflow: auto; background: #122520; color: #e8f5f1; border-radius: 10px; padding: 12px; box-shadow: inset 0 0 0 1px rgba(124,196,178,.24); }
    .content pre code { background: transparent; color: inherit; padding: 0; border-radius: 0; }
    .content pre.auto-code { border-left: 4px solid #2ea78c; }
    .content .kv-row { display: flex; gap: 8px; align-items: baseline; flex-wrap: wrap; }
    .content .kv-key { color: #1b5e50; font-weight: 700; }
    .doc-table-wrap { overflow-x: auto; margin: 8px 0; }
    .doc-table { width: 100%; border-collapse: collapse; min-width: 640px; }
    .doc-table th, .doc-table td { border: 1px solid #c8d8d3; padding: 8px; text-align: left; vertical-align: top; }
    .doc-table th { background: #e8f4f0; }
    .doc-figure { margin: 10px 0; }
    .doc-figure img { max-width: 100%; height: auto; border: 1px solid #c8d8d3; border-radius: 8px; display: block; background: #f3f7f6; }
    .doc-figure.xmind-figure { margin: 6px 0; }
    .doc-figure.xmind-figure figcaption { margin-top: 8px; font-size: 13px; color: #496861; }
    .doc-figure .img-fallback { display: none; margin-top: 6px; font-size: 12px; color: #496861; }
    .doc-figure .img-fallback a { color: #0f7668; }
    .doc-figure.img-load-failed .img-fallback { display: block; }

    .view-controls { position: fixed; top: 12px; right: 12px; z-index: 3000; display: flex; align-items: center; gap: 6px; background: rgba(255,255,255,.94); border: 1px solid #d5e2de; border-radius: 999px; padding: 6px 8px; box-shadow: 0 6px 20px rgba(16,35,28,.12); }
    .view-controls button { border: 1px solid #c6d8d3; background: #f3faf8; color: #0f7668; border-radius: 999px; min-width: 30px; height: 30px; cursor: pointer; font-size: 14px; }
    .view-controls button:hover { background: #e3f2ee; }
    .view-controls .zoom-value { font-size: 12px; color: #3b5d56; min-width: 44px; text-align: center; }
    .zoom-root { transform-origin: top center; }
    

    .doc-figure img { cursor: zoom-in; }
    .img-modal { position: fixed; inset: 0; display: none; z-index: 4000; }
    .img-modal.open { display: block; }
    .img-modal-backdrop { position: absolute; inset: 0; background: rgba(10, 14, 18, .85); }
    .img-modal-toolbar { position: absolute; top: 12px; right: 12px; z-index: 2; display: flex; gap: 6px; align-items: center; background: rgba(255,255,255,.95); border-radius: 999px; padding: 6px 8px; }
    .img-modal-toolbar button { border: 1px solid #c6d8d3; background: #f3faf8; color: #0f7668; border-radius: 999px; min-width: 30px; height: 30px; cursor: pointer; }
    .img-modal-toolbar .zoom-value { min-width: 44px; text-align: center; font-size: 12px; color: #3b5d56; }
    .img-modal-image-wrap { position: absolute; inset: 64px 24px 24px; display: grid; place-items: center; overflow: auto; cursor: grab; user-select: none; touch-action: none; }
    .img-modal-image-wrap.dragging { cursor: grabbing; }
    .img-modal-image-wrap img { max-width: 100%; max-height: 100%; transform-origin: center center; pointer-events: none; -webkit-user-drag: none; user-select: none; }
    
  </style>
</head>
<body>
  
  <div class="view-controls" aria-label="é¡µé¢ç¼©æ”¾å·¥å…·">
    <button type="button" data-zoom="out" title="ç¼©å°">-</button>
    <button type="button" data-zoom="in" title="æ”¾å¤§">+</button>
    <button type="button" data-zoom="reset" title="é‡ç½®">100%</button>
    <span class="zoom-value" id="zoom-value">100%</span>
  </div>

  <div class="zoom-root" id="zoom-root">
  <main class="wrap">
    <div class="top">
      <a class="back" href="../knowledge-map.html">è¿”å›å…¥å£</a>
      <a class="back" id="chapter-back-link" href="../knowledge-map-chapters.html">è¿”å›ç« èŠ‚åˆ—è¡¨</a>
    </div>
    <h1>KMPå·¥ç¨‹é›†æˆé¸¿è’™åº”ç”¨å®Œæ•´æ•™ç¨‹</h1>
    <div class="meta">
      <span class="chip">CMPæ¡†æ¶çŸ¥è¯†åœ°å›¾</span>
      <span class="chip">99 åˆ†é’Ÿ</span>
      <span class="chip">environment-setup/KMPå·¥ç¨‹é›†æˆé¸¿è’™åº”ç”¨å®Œæ•´æ•™ç¨‹.md</span>
    </div>

      <section class="section">
        <div class="section-head">
          <h2>KMPå·¥ç¨‹é›†æˆé¸¿è’™åº”ç”¨å®Œæ•´æ•™ç¨‹</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">æœ¬æ•™ç¨‹å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä»é›¶å¼€å§‹åˆ›å»ºä¸€ä¸ªKotlin Multiplatform (KMP) å·¥ç¨‹ï¼Œå¹¶é›†æˆé¸¿è’™(HarmonyOS)åº”ç”¨ã€‚</p>
        <ul class="points"><li>æœ¬æ•™ç¨‹å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä»é›¶å¼€å§‹åˆ›å»ºä¸€ä¸ªKotlin Multiplatform (KMP) å·¥ç¨‹ï¼Œå¹¶é›†æˆé¸¿è’™(HarmonyOS)åº”ç”¨ã€‚</li></ul>
        <div class="content rich"><p>æœ¬æ•™ç¨‹å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä»é›¶å¼€å§‹åˆ›å»ºä¸€ä¸ªKotlin Multiplatform (KMP) å·¥ç¨‹ï¼Œå¹¶é›†æˆé¸¿è’™(HarmonyOS)åº”ç”¨ã€‚</p></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>1.1 ç¯å¢ƒè¦æ±‚</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">Android Studio (æ”¯æŒKMPçš„æœ€æ–°ç‰ˆæœ¬) DevEco Studio (ç”¨äºé¸¿è’™åº”ç”¨å¼€å‘) JDK 11 æˆ–æ›´é«˜ç‰ˆæœ¬ Kotlin 2.2.0-ohos-07...</p>
        <ul class="points"><li>Android Studio (æ”¯æŒKMPçš„æœ€æ–°ç‰ˆæœ¬)</li><li>DevEco Studio (ç”¨äºé¸¿è’™åº”ç”¨å¼€å‘)</li><li>JDK 11 æˆ–æ›´é«˜ç‰ˆæœ¬</li><li>Kotlin 2.2.0-ohos-07 æˆ–å…¼å®¹ç‰ˆæœ¬</li></ul>
        <div class="content rich"><ul><li>Android Studio (æ”¯æŒKMPçš„æœ€æ–°ç‰ˆæœ¬)</li><li>DevEco Studio (ç”¨äºé¸¿è’™åº”ç”¨å¼€å‘)</li><li>JDK 11 æˆ–æ›´é«˜ç‰ˆæœ¬</li><li>Kotlin 2.2.0-ohos-07 æˆ–å…¼å®¹ç‰ˆæœ¬</li></ul></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>1.2 å¿…è¦çš„ä¾èµ–ä»“åº“</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">KMPé¸¿è’™æ”¯æŒä»“åº“: https://kmp-ohos-test.obs.cn-south-1.myhuaweicloud.com/maven/ è…¾è®¯Mavenä»“åº“: htt...</p>
        <ul class="points"><li>KMPé¸¿è’™æ”¯æŒä»“åº“: https://kmp-ohos-test.obs.cn-south-1.myhuaweicloud.com/maven/</li><li>è…¾è®¯Mavenä»“åº“: https://mirrors.tencent.com/nexus/repository/maven-tencent</li></ul>
        <div class="content rich"><ul><li>KMPé¸¿è’™æ”¯æŒä»“åº“: <code>https://kmp-ohos-test.obs.cn-south-1.myhuaweicloud.com/maven/</code></li><li>è…¾è®¯Mavenä»“åº“: <code>https://mirrors.tencent.com/nexus/repository/maven-tencent</code></li></ul></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>2.1 ä½¿ç”¨Android Studioåˆ›å»ºKMPé¡¹ç›®</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">æ–°å»ºå·¥ç¨‹å…¥å£.png æ‰“å¼€Android Studio é€‰æ‹© **File** -&gt; **New** -&gt; **New Project** é€‰æ‹© **Kotlin Multi...</p>
        <ul class="points"><li>æ–°å»ºå·¥ç¨‹å…¥å£.png</li><li>æ‰“å¼€Android Studio</li><li>é€‰æ‹© **File** -&gt; **New** -&gt; **New Project**</li><li>é€‰æ‹© **Kotlin Multiplatform** æ¨¡æ¿</li></ul>
        <div class="content rich"><figure class="doc-figure"><img src="../knowledge-map-assets/kmp-f03735ca-md-3488ef63ac.png" alt="æ–°å»ºå·¥ç¨‹å…¥å£.png" loading="lazy" referrerpolicy="no-referrer" data-origin-src="../knowledge-map-assets/kmp-f03735ca-md-3488ef63ac.png" data-local-match="direct" /><figcaption class="img-fallback">å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œ<a class="img-open-link" href="../knowledge-map-assets/kmp-f03735ca-md-3488ef63ac.png" target="_blank" rel="noopener noreferrer">ç‚¹å‡»æ‰“å¼€åŸå›¾</a></figcaption></figure><ol><li>æ‰“å¼€Android Studio</li><li>é€‰æ‹© <strong>File</strong> -&gt; <strong>New</strong> -&gt; <strong>New Project</strong></li><li>é€‰æ‹© <strong>Kotlin Multiplatform</strong> æ¨¡æ¿</li></ol><figure class="doc-figure"><img src="../knowledge-map-assets/kmp-f03735ca-md-22531d041d.png" alt="é€‰æ‹©KMPé¡¹ç›®.png" loading="lazy" referrerpolicy="no-referrer" data-origin-src="../knowledge-map-assets/kmp-f03735ca-md-22531d041d.png" data-local-match="direct" /><figcaption class="img-fallback">å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œ<a class="img-open-link" href="../knowledge-map-assets/kmp-f03735ca-md-22531d041d.png" target="_blank" rel="noopener noreferrer">ç‚¹å‡»æ‰“å¼€åŸå›¾</a></figcaption></figure></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>2.2 é…ç½®å·¥ç¨‹åŸºæœ¬ä¿¡æ¯</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">ä¿®æ”¹å·¥ç¨‹åå’ŒåŒ…å.png é…ç½®é¡¹è¯´æ˜ï¼š **Name**: MyKMPApp (å·¥ç¨‹åç§°) **Package name**: com.example.mykmpapp (åŒ…...</p>
        <ul class="points"><li>ä¿®æ”¹å·¥ç¨‹åå’ŒåŒ…å.png</li><li>é…ç½®é¡¹è¯´æ˜ï¼š</li><li>**Name**: MyKMPApp (å·¥ç¨‹åç§°)</li><li>**Package name**: com.example.mykmpapp (åŒ…å)</li></ul>
        <div class="content rich"><figure class="doc-figure"><img src="../knowledge-map-assets/kmp-f03735ca-md-7d9215a96c.png" alt="ä¿®æ”¹å·¥ç¨‹åå’ŒåŒ…å.png" loading="lazy" referrerpolicy="no-referrer" data-origin-src="../knowledge-map-assets/kmp-f03735ca-md-7d9215a96c.png" data-local-match="direct" /><figcaption class="img-fallback">å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œ<a class="img-open-link" href="../knowledge-map-assets/kmp-f03735ca-md-7d9215a96c.png" target="_blank" rel="noopener noreferrer">ç‚¹å‡»æ‰“å¼€åŸå›¾</a></figcaption></figure><p>é…ç½®é¡¹è¯´æ˜ï¼š</p><ul><li><strong>Name</strong>: MyKMPApp (å·¥ç¨‹åç§°)</li><li><strong>Package name</strong>: com.example.mykmpapp (åŒ…å)</li><li><strong>Save location</strong>: é€‰æ‹©åˆé€‚çš„ä¿å­˜ä½ç½®</li></ul><figure class="doc-figure"><img src="../knowledge-map-assets/kmp-f03735ca-md-575ace531d.png" alt="é€‰æ‹©å¹³å°ä¸€èˆ¬é»˜è®¤.png" loading="lazy" referrerpolicy="no-referrer" data-origin-src="../knowledge-map-assets/kmp-f03735ca-md-575ace531d.png" data-local-match="direct" /><figcaption class="img-fallback">å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œ<a class="img-open-link" href="../knowledge-map-assets/kmp-f03735ca-md-575ace531d.png" target="_blank" rel="noopener noreferrer">ç‚¹å‡»æ‰“å¼€åŸå›¾</a></figcaption></figure></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>2.3 é€‰æ‹©ç›®æ ‡å¹³å°</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">é»˜è®¤æƒ…å†µä¸‹ä¼šåŒ…å«ï¼š Android iOS æ³¨æ„ï¼šé¸¿è’™å¹³å°éœ€è¦åç»­æ‰‹åŠ¨é…ç½®</p>
        <ul class="points"><li>é»˜è®¤æƒ…å†µä¸‹ä¼šåŒ…å«ï¼š</li><li>Android</li><li>iOS</li><li>æ³¨æ„ï¼šé¸¿è’™å¹³å°éœ€è¦åç»­æ‰‹åŠ¨é…ç½®</li></ul>
        <div class="content rich"><p>é»˜è®¤æƒ…å†µä¸‹ä¼šåŒ…å«ï¼š</p><ul><li>Android</li><li>iOS</li></ul><blockquote><p>æ³¨æ„ï¼šé¸¿è’™å¹³å°éœ€è¦åç»­æ‰‹åŠ¨é…ç½®</p></blockquote></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>3.1 é…ç½®Gradleä¾èµ–ä»“åº“</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">ä¿®æ”¹ settings.gradle.kts æ–‡ä»¶ï¼Œæ·»åŠ é¸¿è’™ç›¸å…³çš„Mavenä»“åº“ï¼š kotlin pluginManagement { repositories { mave...</p>
        <ul class="points"><li>ä¿®æ”¹ settings.gradle.kts æ–‡ä»¶ï¼Œæ·»åŠ é¸¿è’™ç›¸å…³çš„Mavenä»“åº“ï¼š</li><li>kotlin</li><li>pluginManagement {</li><li>repositories {</li></ul>
        <div class="content rich"><p>ä¿®æ”¹ <code>settings.gradle.kts</code> æ–‡ä»¶ï¼Œæ·»åŠ é¸¿è’™ç›¸å…³çš„Mavenä»“åº“ï¼š</p><pre><code class="language-kotlin">pluginManagement {
    repositories {
        maven("https://kmp-ohos-test.obs.cn-south-1.myhuaweicloud.com/maven/")
        maven("https://mirrors.tencent.com/nexus/repository/maven-tencent")
        google {
            mavenContent {
                includeGroupAndSubgroups("androidx")
                includeGroupAndSubgroups("com.android")
                includeGroupAndSubgroups("com.google")
            }
        }
        mavenCentral()
        gradlePluginPortal()
    }
}

dependencyResolutionManagement {
    repositories {
        maven("https://kmp-ohos-test.obs.cn-south-1.myhuaweicloud.com/maven/")
        maven("https://mirrors.tencent.com/nexus/repository/maven-tencent")
        google {
            mavenContent {
                includeGroupAndSubgroups("androidx")
                includeGroupAndSubgroups("com.android")
                includeGroupAndSubgroups("com.google")
            }
        }
        mavenCentral()
    }
}</code></pre></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>3.2 é…ç½®ç‰ˆæœ¬ä¾èµ–</h2>
          <span>4 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">ä¿®æ”¹ gradle/libs.versions.toml æ–‡ä»¶ï¼Œé…ç½®é¸¿è’™ç›¸å…³çš„ç‰ˆæœ¬ã€‚**å…³é”®é…ç½®**å¦‚ä¸‹ï¼ˆå…¶ä»–AndroidXåº“ä½¿ç”¨é»˜è®¤é…ç½®å³å¯ï¼‰ï¼š toml [versio...</p>
        <ul class="points"><li>ä¿®æ”¹ gradle/libs.versions.toml æ–‡ä»¶ï¼Œé…ç½®é¸¿è’™ç›¸å…³çš„ç‰ˆæœ¬ã€‚**å…³é”®é…ç½®**å¦‚ä¸‹ï¼ˆå…¶ä»–AndroidXåº“ä½¿ç”¨é»˜è®¤é…ç½®å³å¯ï¼‰ï¼š</li><li>toml</li><li>[versions]</li><li>composeMultiplatform = &quot;1.6.1-ohos-003&quot;</li></ul>
        <div class="content rich"><p>ä¿®æ”¹ <code>gradle/libs.versions.toml</code> æ–‡ä»¶ï¼Œé…ç½®é¸¿è’™ç›¸å…³çš„ç‰ˆæœ¬ã€‚<strong>å…³é”®é…ç½®</strong>å¦‚ä¸‹ï¼ˆå…¶ä»–AndroidXåº“ä½¿ç”¨é»˜è®¤é…ç½®å³å¯ï¼‰ï¼š</p><pre><code class="language-toml">[versions]
composeMultiplatform = "1.6.1-ohos-003"
kotlin = "2.2.0-ohos-07"
atomicFu = "0.23.2-KBA-001"
kotlinx-coroutines = "1.8.0-KBA-001"

[libraries]
androidx-activity-compose = { module = "androidx.activity:activity-compose", version.ref = "androidx-activity" }
compose-multiplatform-export = { module = "org.jetbrains.compose.export:export", version.ref = "composeMultiplatform" }
atomicFu = { module = "org.jetbrains.kotlinx:atomicfu", version.ref = "atomicFu" }
kotlinx-coroutines-core = { module = "org.jetbrains.kotlinx:kotlinx-coroutines-core", version.ref = "kotlinx-coroutines" }

[plugins]
composeMultiplatform = { id = "org.jetbrains.compose", version.ref = "composeMultiplatform" }
composeCompiler = { id = "org.jetbrains.kotlin.plugin.compose", version.ref = "kotlin" }
kotlinMultiplatform = { id = "org.jetbrains.kotlin.multiplatform", version.ref = "kotlin" }</code></pre><p><strong>å…³é”®ç‰ˆæœ¬è¯´æ˜</strong>ï¼š</p><ul><li><code>kotlin = "2.2.0-ohos-07"</code>: æ”¯æŒé¸¿è’™çš„Kotlinç‰ˆæœ¬ï¼ˆ<strong>å¿…é¡»ä½¿ç”¨æ­¤ç‰ˆæœ¬</strong>ï¼‰</li><li><code>composeMultiplatform = "1.6.1-ohos-003"</code>: æ”¯æŒé¸¿è’™çš„Compose Multiplatformç‰ˆæœ¬ï¼ˆ<strong>å¿…é¡»ä½¿ç”¨æ­¤ç‰ˆæœ¬</strong>ï¼‰</li><li><code>atomicFu = "0.23.2-KBA-001"</code>: KMPåŸå­æ“ä½œåº“ï¼Œç”¨äºè·¨å¹³å°åŸå­æ€§æ“ä½œ</li><li><code>kotlinx-coroutines = "1.8.0-KBA-001"</code>: è·¨å¹³å°åç¨‹åº“</li><li>æ³¨æ„ï¼š<code>composeMultiplatform</code> ä½¿ç”¨é©¼å³°å‘½åï¼Œåœ¨å¼•ç”¨æ—¶ä½¿ç”¨ <code>version.ref = "composeMultiplatform"</code></li></ul></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>3.3 é…ç½®composeAppæ¨¡å—</h2>
          <span>6 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">ä¿®æ”¹ composeApp/build.gradle.ktsï¼Œæ·»åŠ é¸¿è’™å¹³å°é…ç½®ï¼š kotlin kotlin { androidTarget { compilerOption...</p>
        <ul class="points"><li>ä¿®æ”¹ composeApp/build.gradle.ktsï¼Œæ·»åŠ é¸¿è’™å¹³å°é…ç½®ï¼š</li><li>kotlin</li><li>kotlin {</li><li>androidTarget {</li></ul>
        <div class="content rich"><p>ä¿®æ”¹ <code>composeApp/build.gradle.kts</code>ï¼Œæ·»åŠ é¸¿è’™å¹³å°é…ç½®ï¼š</p><pre><code class="language-kotlin">kotlin {
    androidTarget {
        compilerOptions {
            jvmTarget.set(JvmTarget.JVM_11)
        }
    }
    
    listOf(
        iosArm64(),
        iosSimulatorArm64()
    ).forEach { iosTarget -&gt;
        iosTarget.binaries.framework {
            baseName = "ComposeApp"
            isStatic = true
        }
    }

    // æ·»åŠ é¸¿è’™å¹³å°é…ç½®
    ohosArm64 {
        binaries.sharedLib {
            baseName = "kn"
            export(libs.compose.multiplatform.export)
            linkerOpts(
                "-lnative_drawing",
                "-lpixelmap",
                "-lpixelmap_ndk.z",
                "-lace_napi.z",
                "-lhilog_ndk.z",
                "-limage_source",
                "-lhitrace_ndk.z",
                "-luv",
                "-lnative_window",
                "-lunwind",
            )
            // debugå’Œreleaseæ¨¡å¼éƒ½æ‰“åŒ…å¸¦ç¬¦å·è¡¨çš„so
            debuggable = true
        }
        compilations.all {
            compilerOptions.configure {
            }
        }

        // é…ç½®cinteropç”¨äºè®¿é—®é¸¿è’™èµ„æº
        val main by compilations.getting
        val resource by main.cinterops.creating {
            defFile(file("src/ohosArm64Main/cinterop/resource.def"))
            includeDirs(file("src/ohosArm64Main/cinterop/include"))
        }
    }
    
    sourceSets {
        androidMain.dependencies {
            implementation(compose.preview)
            implementation(libs.androidx.activity.compose)
        }
        commonMain.dependencies {
            implementation(compose.runtime)
            implementation(compose.foundation)
            implementation(compose.material3)
            implementation(compose.ui)
            implementation(compose.components.resources)
            implementation(compose.components.uiToolingPreview)
            implementation(libs.kotlinx.coroutines.core)
            implementation(libs.atomicFu)
        }

        // é¸¿è’™å¹³å°ä¾èµ–
        val ohosArm64Main by getting {
            dependencies {
                api(libs.compose.multiplatform.export)
            }
        }
    }
}

// é…ç½®è‡ªåŠ¨å‘å¸ƒä»»åŠ¡
arrayOf("debug", "release").forEach { type -&gt;
    tasks.register&lt;Copy&gt;("publish${type.capitalizeUS()}BinariesToHarmonyApp") {
        group = "harmony"
        dependsOn("link${type.capitalizeUS()}SharedOhosArm64")
        into(rootProject.file("harmonyApp"))
        from("build/bin/ohosArm64/${type}Shared/libkn_api.h") {
            into("entry/src/main/cpp/include/")
        }
        from(project.file("build/bin/ohosArm64/${type}Shared/libkn.so")) {
            into("/entry/libs/arm64-v8a/")
        }
    }
}</code></pre><p><strong>å…³é”®é…ç½®è¯´æ˜</strong>ï¼š</p><ul><li><code>ohosArm64</code>: å£°æ˜é¸¿è’™å¹³å°ç›®æ ‡</li><li><code>sharedLib</code>: ç”Ÿæˆå…±äº«åº“(.soæ–‡ä»¶)</li><li><code>baseName = "kn"</code>: ç”Ÿæˆçš„soæ–‡ä»¶åä¸ºlibkn.so</li><li><code>linkerOpts</code>: é“¾æ¥é¸¿è’™NDKåº“</li><li><code>cinterops</code>: é…ç½®Cäº’æ“ä½œï¼Œç”¨äºè®¿é—®é¸¿è’™èµ„æºç®¡ç†å™¨</li></ul></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>3.4 åˆ›å»ºé¸¿è’™å¹³å°ä»£ç </h2>
          <span>6 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">3.4.1 åˆ›å»ºç›®å½•ç»“æ„ composeApp/src/ohosArm64Main/ â”œâ”€â”€ cinterop/ â”‚ â”œâ”€â”€ include/ â”‚ â”‚ â”œâ”€â”€ raw_fil...</p>
        <ul class="points"><li>3.4.1 åˆ›å»ºç›®å½•ç»“æ„</li><li>composeApp/src/ohosArm64Main/</li><li>â”œâ”€â”€ cinterop/</li><li>â”‚ â”œâ”€â”€ include/</li></ul>
        <div class="content rich"><h4>3.4.1 åˆ›å»ºç›®å½•ç»“æ„</h4><pre><code>composeApp/src/ohosArm64Main/
â”œâ”€â”€ cinterop/
â”‚   â”œâ”€â”€ include/
â”‚   â”‚   â”œâ”€â”€ raw_file.h
â”‚   â”‚   â””â”€â”€ raw_file_manager.h
â”‚   â””â”€â”€ resource.def
â””â”€â”€ kotlin/
    â””â”€â”€ com/example/mykmpapp/
        â”œâ”€â”€ App.ohos.kt
        â”œâ”€â”€ MainArkUIViewController.kt
        â””â”€â”€ Platform.ohos.kt</code></pre><h4>3.4.2 é…ç½®cinterop</h4><p>åˆ›å»º <code>composeApp/src/ohosArm64Main/cinterop/resource.def</code>:</p><pre><code>package = platform.resource
headers = raw_file_manager.h raw_file.h</code></pre><h4>3.4.3 å®ç°å¹³å°ç‰¹å®šä»£ç </h4><p>åˆ›å»º <code>composeApp/src/ohosArm64Main/kotlin/com/example/mykmpapp/Platform.ohos.kt</code>:</p><pre><code class="language-kotlin">package com.example.mykmpapp

import kotlinx.cinterop.ExperimentalForeignApi
import kotlinx.cinterop.toKString
import platform.ohos.OH_GetOSFullName

internal class OHOSPlatform : Platform {
    @OptIn(ExperimentalForeignApi::class)
    override val name: String = "OHOS"
}

actual fun getPlatform(): Platform = OHOSPlatform()</code></pre><p>åˆ›å»º <code>composeApp/src/ohosArm64Main/kotlin/com/example/mykmpapp/MainArkUIViewController.kt</code>:</p><pre><code class="language-kotlin">@file:OptIn(ExperimentalForeignApi::class)

package com.example.mykmpapp

import androidx.compose.ui.window.ComposeArkUIViewController
import kotlinx.cinterop.CPointer
import kotlinx.cinterop.ExperimentalForeignApi
import kotlinx.coroutines.initMainHandler
import platform.ohos.napi_env
import platform.ohos.napi_value
import kotlin.experimental.ExperimentalNativeApi

@OptIn(ExperimentalNativeApi::class)
@CName("MainArkUIViewController")
fun MainArkUIViewController(env: napi_env): napi_value {
    initMainHandler(env)
    return ComposeArkUIViewController(env) {
        App()
    }
}

typealias NativeResourceManager = CPointer&lt;cnames.structs.NativeResourceManager&gt;?
var nativeResourceManager: NativeResourceManager = null

@OptIn(ExperimentalForeignApi::class)
fun initResourceManager(resourceManager: NativeResourceManager) {
    nativeResourceManager = resourceManager
}</code></pre><p><strong>å…³é”®ä»£ç è¯´æ˜</strong>ï¼š</p><ul><li><code>@CName("MainArkUIViewController")</code>: å¯¼å‡ºCå‡½æ•°ä¾›é¸¿è’™è°ƒç”¨</li><li><code>ComposeArkUIViewController</code>: åˆ›å»ºCompose ArkUIè§†å›¾æ§åˆ¶å™¨</li><li><code>initMainHandler</code>: åˆå§‹åŒ–åç¨‹ä¸»çº¿ç¨‹å¤„ç†å™¨</li><li><code>initResourceManager</code>: åˆå§‹åŒ–èµ„æºç®¡ç†å™¨</li></ul></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>4.1 ä½¿ç”¨DevEco Studioåˆ›å»ºNativeå·¥ç¨‹</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">DevecoStudioæ–°å»ºå·¥ç¨‹å…¥å£.png æ‰“å¼€DevEco Studio é€‰æ‹© **File** -&gt; **New** -&gt; **Create Project** Dev...</p>
        <ul class="points"><li>DevecoStudioæ–°å»ºå·¥ç¨‹å…¥å£.png</li><li>æ‰“å¼€DevEco Studio</li><li>é€‰æ‹© **File** -&gt; **New** -&gt; **Create Project**</li><li>DevecoStudioæ–°å»ºNativeå·¥ç¨‹.png</li></ul>
        <div class="content rich"><figure class="doc-figure"><img src="../knowledge-map-assets/kmp-f03735ca-md-93db0f5d92.png" alt="DevecoStudioæ–°å»ºå·¥ç¨‹å…¥å£.png" loading="lazy" referrerpolicy="no-referrer" data-origin-src="../knowledge-map-assets/kmp-f03735ca-md-93db0f5d92.png" data-local-match="direct" /><figcaption class="img-fallback">å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œ<a class="img-open-link" href="../knowledge-map-assets/kmp-f03735ca-md-93db0f5d92.png" target="_blank" rel="noopener noreferrer">ç‚¹å‡»æ‰“å¼€åŸå›¾</a></figcaption></figure><ol><li>æ‰“å¼€DevEco Studio</li><li>é€‰æ‹© <strong>File</strong> -&gt; <strong>New</strong> -&gt; <strong>Create Project</strong></li></ol><figure class="doc-figure"><img src="../knowledge-map-assets/kmp-f03735ca-md-f04a02834d.png" alt="DevecoStudioæ–°å»ºNativeå·¥ç¨‹.png" loading="lazy" referrerpolicy="no-referrer" data-origin-src="../knowledge-map-assets/kmp-f03735ca-md-f04a02834d.png" data-local-match="direct" /><figcaption class="img-fallback">å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œ<a class="img-open-link" href="../knowledge-map-assets/kmp-f03735ca-md-f04a02834d.png" target="_blank" rel="noopener noreferrer">ç‚¹å‡»æ‰“å¼€åŸå›¾</a></figcaption></figure><ol><li>é€‰æ‹© <strong>Native C++</strong> æ¨¡æ¿</li></ol><figure class="doc-figure"><img src="../knowledge-map-assets/kmp-f03735ca-md-a92530d48e.png" alt="DevecoStudioæ–°å»ºç›¸åŒåŒ…åçš„Nativeåº”ç”¨.png" loading="lazy" referrerpolicy="no-referrer" data-origin-src="../knowledge-map-assets/kmp-f03735ca-md-a92530d48e.png" data-local-match="direct" /><figcaption class="img-fallback">å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œ<a class="img-open-link" href="../knowledge-map-assets/kmp-f03735ca-md-a92530d48e.png" target="_blank" rel="noopener noreferrer">ç‚¹å‡»æ‰“å¼€åŸå›¾</a></figcaption></figure><ol><li>é…ç½®åº”ç”¨ä¿¡æ¯ï¼š<ul><li><strong>Project name</strong>: harmonyApp</li><li><strong>Bundle name</strong>: com.example.mykmpapp (ä¸KMPå·¥ç¨‹åŒ…åä¸€è‡´)</li></ul></li></ol></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>4.2 å¤åˆ¶é¸¿è’™å·¥ç¨‹åˆ°KMPé¡¹ç›®</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">å¤åˆ¶harmonyAppè‡³kmpApp.png å°†åˆ›å»ºå¥½çš„ harmonyApp ç›®å½•å¤åˆ¶åˆ°KMPå·¥ç¨‹æ ¹ç›®å½•ä¸‹ã€‚</p>
        <ul class="points"><li>å¤åˆ¶harmonyAppè‡³kmpApp.png</li><li>å°†åˆ›å»ºå¥½çš„ harmonyApp ç›®å½•å¤åˆ¶åˆ°KMPå·¥ç¨‹æ ¹ç›®å½•ä¸‹ã€‚</li></ul>
        <div class="content rich"><figure class="doc-figure"><img src="../knowledge-map-assets/kmp-f03735ca-md-9ad9e21275.png" alt="å¤åˆ¶harmonyAppè‡³kmpApp.png" loading="lazy" referrerpolicy="no-referrer" data-origin-src="../knowledge-map-assets/kmp-f03735ca-md-9ad9e21275.png" data-local-match="direct" /><figcaption class="img-fallback">å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œ<a class="img-open-link" href="../knowledge-map-assets/kmp-f03735ca-md-9ad9e21275.png" target="_blank" rel="noopener noreferrer">ç‚¹å‡»æ‰“å¼€åŸå›¾</a></figcaption></figure><p>å°†åˆ›å»ºå¥½çš„ <code>harmonyApp</code> ç›®å½•å¤åˆ¶åˆ°KMPå·¥ç¨‹æ ¹ç›®å½•ä¸‹ã€‚</p></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>4.3 ä½¿ç”¨Patchå¿«é€Ÿé›†æˆï¼ˆæ¨èï¼‰</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">**é‡è¦æç¤º**ï¼šä¸ºäº†ç®€åŒ–é›†æˆæµç¨‹ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„patchæ–‡ä»¶ï¼ŒåŒ…å«äº†æ‰€æœ‰å¿…è¦çš„ä¿®æ”¹ã€‚</p>
        <ul class="points"><li>**é‡è¦æç¤º**ï¼šä¸ºäº†ç®€åŒ–é›†æˆæµç¨‹ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„patchæ–‡ä»¶ï¼ŒåŒ…å«äº†æ‰€æœ‰å¿…è¦çš„ä¿®æ”¹ã€‚</li><li>**Patchæ–‡ä»¶**ï¼šğŸ“ KMPåº”ç”¨é›†æˆé¸¿è’™åº”ç”¨å¿…è¦ä¿®æ”¹.patch ï¼ˆç‚¹å‡»å¯ç›´æ¥æ‰“å¼€æŸ¥çœ‹ï¼‰</li><li>**ä½¿ç”¨æ–¹æ³•**ï¼š</li><li>**æ–¹å¼ä¸€ï¼šç›´æ¥åº”ç”¨Patchï¼ˆæ¨èï¼‰**</li></ul>
        <div class="content rich"><p><strong>é‡è¦æç¤º</strong>ï¼šä¸ºäº†ç®€åŒ–é›†æˆæµç¨‹ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„patchæ–‡ä»¶ï¼ŒåŒ…å«äº†æ‰€æœ‰å¿…è¦çš„ä¿®æ”¹ã€‚</p><p><strong>Patchæ–‡ä»¶</strong>ï¼š<a href="KMPåº”ç”¨é›†æˆé¸¿è’™åº”ç”¨å¿…è¦ä¿®æ”¹.patch" target="_blank" rel="noopener noreferrer">ğŸ“ KMPåº”ç”¨é›†æˆé¸¿è’™åº”ç”¨å¿…è¦ä¿®æ”¹.patch</a> ï¼ˆç‚¹å‡»å¯ç›´æ¥æ‰“å¼€æŸ¥çœ‹ï¼‰</p><p><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š</p><ol><li><strong>æ–¹å¼ä¸€ï¼šç›´æ¥åº”ç”¨Patchï¼ˆæ¨èï¼‰</strong></li></ol><pre><code class="language-bash">   # åœ¨KMPå·¥ç¨‹æ ¹ç›®å½•æ‰§è¡Œ
   git apply KMPåº”ç”¨é›†æˆé¸¿è’™åº”ç”¨å¿…è¦ä¿®æ”¹.patch</code></pre><p>æˆ–è€…ä½¿ç”¨å®Œæ•´è·¯å¾„ï¼š</p><pre><code class="language-bash">   git apply "KMPåº”ç”¨é›†æˆé¸¿è’™åº”ç”¨å¿…è¦ä¿®æ”¹.patch"</code></pre><ol><li><strong>æ–¹å¼äºŒï¼šæ‰‹åŠ¨é…ç½®</strong></li></ol><p>å¦‚æœæ‚¨æƒ³äº†è§£æ¯ä¸ªä¿®æ”¹çš„è¯¦ç»†å†…å®¹ï¼Œå¯ä»¥æŒ‰ç…§ç¬¬äº”èŠ‚çš„è¯¦ç»†è¯´æ˜é€æ­¥é…ç½®ã€‚</p><p><strong>PatchåŒ…å«çš„ä¿®æ”¹å†…å®¹</strong>ï¼š</p><ul><li>âœ… KMPå·¥ç¨‹é…ç½®ï¼ˆ<code>settings.gradle.kts</code>, <code>gradle/libs.versions.toml</code>, <code>composeApp/build.gradle.kts</code>ï¼‰</li><li>âœ… é¸¿è’™å¹³å°ä»£ç ï¼ˆ<code>Platform.ohos.kt</code>, <code>MainArkUIViewController.kt</code>, <code>App.ohos.kt</code>ï¼‰</li><li>âœ… Cäº’æ“ä½œé…ç½®ï¼ˆ<code>resource.def</code>, <code>raw_file.h</code>, <code>raw_file_manager.h</code>ï¼‰</li><li>âœ… é¸¿è’™åº”ç”¨é…ç½®ï¼ˆ<code>build-profile.json5</code>, <code>oh-package.json5</code>, <code>CMakeLists.txt</code>ï¼‰</li><li>âœ… NAPIæ¡¥æ¥ä»£ç ï¼ˆ<code>napi_init.cpp</code>ï¼‰</li><li>âœ… ArkTSé¡µé¢ä»£ç ï¼ˆ<code>Index.ets</code>, <code>ComposeSample.ets</code>, <code>ComposeInterops.ets</code>ï¼‰</li><li>âœ… Composeæ”¯æŒåº“ï¼ˆ<code>compose.har</code>ï¼‰</li></ul><blockquote><p><strong>æ³¨æ„</strong>ï¼šåº”ç”¨patchåï¼Œæ‚¨å¯ä»¥ç›´æ¥è·³åˆ°ç¬¬å…­èŠ‚"ç¼–è¯‘å’Œè¿è¡Œ"è¿›è¡ŒéªŒè¯ã€‚å¦‚æœæ‚¨æƒ³äº†è§£æ¯ä¸ªé…ç½®çš„è¯¦ç»†è¯´æ˜ï¼Œå¯ä»¥ç»§ç»­é˜…è¯»ç¬¬äº”èŠ‚ã€‚</p></blockquote></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>äº”ã€é…ç½®é¸¿è’™å·¥ç¨‹ï¼ˆè¯¦ç»†è¯´æ˜ï¼‰</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">**è¯´æ˜**ï¼šæœ¬èŠ‚è¯¦ç»†ä»‹ç»äº†patchæ–‡ä»¶ä¸­çš„æ‰€æœ‰ä¿®æ”¹ã€‚å¦‚æœæ‚¨å·²ç»åº”ç”¨äº†patchï¼Œå¯ä»¥è·³è¿‡æœ¬èŠ‚ç›´æ¥è¿›å…¥ç¬¬å…­èŠ‚ã€‚æœ¬èŠ‚å†…å®¹å¸®åŠ©æ‚¨ç†è§£æ¯ä¸ªé…ç½®çš„ä½œç”¨å’ŒåŸç†ã€‚</p>
        <ul class="points"><li>**è¯´æ˜**ï¼šæœ¬èŠ‚è¯¦ç»†ä»‹ç»äº†patchæ–‡ä»¶ä¸­çš„æ‰€æœ‰ä¿®æ”¹ã€‚å¦‚æœæ‚¨å·²ç»åº”ç”¨äº†patchï¼Œå¯ä»¥è·³è¿‡æœ¬èŠ‚ç›´æ¥è¿›å…¥ç¬¬å…­èŠ‚ã€‚æœ¬èŠ‚å†…å®¹å¸®åŠ©æ‚¨ç†è§£æ¯ä¸ªé…ç½®çš„ä½œç”¨å’ŒåŸç†ã€‚</li><li>ä»¥ä¸‹å†…å®¹æ˜¯å¯¹patchä¸­æ‰€æœ‰ä¿®æ”¹çš„è¯¦ç»†è¯´æ˜ï¼š</li></ul>
        <div class="content rich"><blockquote><p><strong>è¯´æ˜</strong>ï¼šæœ¬èŠ‚è¯¦ç»†ä»‹ç»äº†patchæ–‡ä»¶ä¸­çš„æ‰€æœ‰ä¿®æ”¹ã€‚å¦‚æœæ‚¨å·²ç»åº”ç”¨äº†patchï¼Œå¯ä»¥è·³è¿‡æœ¬èŠ‚ç›´æ¥è¿›å…¥ç¬¬å…­èŠ‚ã€‚æœ¬èŠ‚å†…å®¹å¸®åŠ©æ‚¨ç†è§£æ¯ä¸ªé…ç½®çš„ä½œç”¨å’ŒåŸç†ã€‚</p></blockquote><p>ä»¥ä¸‹å†…å®¹æ˜¯å¯¹patchä¸­æ‰€æœ‰ä¿®æ”¹çš„è¯¦ç»†è¯´æ˜ï¼š</p></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>5.1 é…ç½®build-profile.json5</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">ç¼–è¾‘ harmonyApp/build-profile.json5ï¼š json5 { &quot;app&quot;: { &quot;signingConfigs&quot;: [ { &quot;name&quot;: &quot;defa...</p>
        <ul class="points"><li>ç¼–è¾‘ harmonyApp/build-profile.json5ï¼š</li><li>json5</li><li>{</li><li>&quot;app&quot;: {</li></ul>
        <div class="content rich"><p>ç¼–è¾‘ <code>harmonyApp/build-profile.json5</code>ï¼š</p><pre><code class="language-json5">{
  "app": {
    "signingConfigs": [
      {
        "name": "default",
        "type": "HarmonyOS",
        "material": {
          // é…ç½®ç­¾åä¿¡æ¯
        }
      }
    ],
    "products": [
      {
        "name": "default",
        "signingConfig": "default",
        "targetSdkVersion": "6.0.0(20)",
        "compatibleSdkVersion": "6.0.0(20)",
        "runtimeOS": "HarmonyOS",
        "buildOption": {
          "nativeCompiler": "BiSheng",
          "strictMode": {
            "caseSensitiveCheck": true,
            "useNormalizedOHMUrl": true
          }
        }
      }
    ]
  }
}</code></pre></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>5.2 é…ç½®entryæ¨¡å—ä¾èµ–</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">ç¼–è¾‘ harmonyApp/entry/oh-package.json5ï¼š json5 { &quot;name&quot;: &quot;entry&quot;, &quot;version&quot;: &quot;1.0.0&quot;, &quot;des...</p>
        <ul class="points"><li>ç¼–è¾‘ harmonyApp/entry/oh-package.json5ï¼š</li><li>json5</li><li>{</li><li>&quot;name&quot;: &quot;entry&quot;,</li></ul>
        <div class="content rich"><p>ç¼–è¾‘ <code>harmonyApp/entry/oh-package.json5</code>ï¼š</p><pre><code class="language-json5">{
  "name": "entry",
  "version": "1.0.0",
  "description": "Please describe the basic information.",
  "main": "",
  "author": "",
  "license": "",
  "dependencies": {
    "libentry.so": "file:./src/main/cpp/types/libentry",
    "compose": "file:./libs/compose.har"
  }
}</code></pre><p><strong>å…³é”®ä¾èµ–è¯´æ˜</strong>ï¼š</p><ul><li><code>libentry.so</code>: æœ¬åœ°C++æ¨¡å—</li><li><code>compose.har</code>: Composeé¸¿è’™æ”¯æŒåº“</li></ul></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>5.3 é…ç½®CMakeLists.txt</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">ç¼–è¾‘ harmonyApp/entry/src/main/cpp/CMakeLists.txtï¼š cmake cmake_minimum_required(VERSION 3...</p>
        <ul class="points"><li>ç¼–è¾‘ harmonyApp/entry/src/main/cpp/CMakeLists.txtï¼š</li><li>cmake</li><li>cmake_minimum_required(VERSION 3.5.0)</li><li>project(harmonyApp)</li></ul>
        <div class="content rich"><p>ç¼–è¾‘ <code>harmonyApp/entry/src/main/cpp/CMakeLists.txt</code>ï¼š</p><pre><code class="language-cmake">cmake_minimum_required(VERSION 3.5.0)
project(harmonyApp)

set(NATIVERENDER_ROOT_PATH ${CMAKE_CURRENT_SOURCE_DIR})

if(DEFINED PACKAGE_FIND_FILE)
    include(${PACKAGE_FIND_FILE})
endif()

include_directories(${NATIVERENDER_ROOT_PATH}
                    ${NATIVERENDER_ROOT_PATH}/include)

add_library(entry SHARED napi_init.cpp)
target_link_libraries(entry PUBLIC libace_napi.z.so)
target_link_libraries(entry PUBLIC librawfile.z.so)
target_link_libraries(entry PUBLIC libace_ndk.z.so)
target_link_libraries(entry PUBLIC ${NATIVERENDER_ROOT_PATH}/../../../libs/arm64-v8a/libkn.so)</code></pre><p><strong>å…³é”®é…ç½®è¯´æ˜</strong>ï¼š</p><ul><li>é“¾æ¥KMPç”Ÿæˆçš„ <code>libkn.so</code> å…±äº«åº“</li><li>é“¾æ¥é¸¿è’™NDKå¿…è¦çš„åº“</li></ul></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>5.4 å®ç°NAPIæ¡¥æ¥ä»£ç </h2>
          <span>5 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">ç¼–è¾‘ harmonyApp/entry/src/main/cpp/napi_init.cppï¼š cpp #include &quot;napi/native_api.h&quot; #inclu...</p>
        <ul class="points"><li>ç¼–è¾‘ harmonyApp/entry/src/main/cpp/napi_init.cppï¼š</li><li>cpp</li><li>#include &quot;napi/native_api.h&quot;</li><li>#include &quot;libkn_api.h&quot;</li></ul>
        <div class="content rich"><p>ç¼–è¾‘ <code>harmonyApp/entry/src/main/cpp/napi_init.cpp</code>ï¼š</p><pre><code class="language-cpp">#include "napi/native_api.h"
#include "libkn_api.h"
#include &lt;rawfile/raw_file_manager.h&gt;

static napi_value MainArkUIViewController(napi_env env, napi_callback_info info) {
    return reinterpret_cast&lt;napi_value&gt;(MainArkUIViewController(env));
}

static napi_value InitResourceManager(napi_env env, napi_callback_info info) {
    size_t argc = 1;
    napi_value args[1] = {nullptr};
    napi_get_cb_info(env, info, &amp;argc, args, nullptr, nullptr);

    auto manager = OH_ResourceManager_InitNativeResourceManager(env, args[0]);
    auto kt = libkn_symbols();
    kt-&gt;kotlin.root.com.example.mykmpapp.initResourceManager(manager);

    napi_value result;
    napi_create_int32(env, 0, &amp;result);
    return result;
}

EXTERN_C_START
static napi_value Init(napi_env env, napi_value exports)
{
    napi_property_descriptor desc[] = {
        {"initResourceManager", nullptr, InitResourceManager, nullptr, nullptr, nullptr, napi_default, nullptr},
        {"MainArkUIViewController", nullptr, MainArkUIViewController, nullptr, nullptr, nullptr, napi_default, nullptr},
    };
    napi_define_properties(env, exports, sizeof(desc) / sizeof(desc[0]), desc);
    return exports;
}
EXTERN_C_END

static napi_module demoModule = {
    .nm_version = 1,
    .nm_flags = 0,
    .nm_filename = nullptr,
    .nm_register_func = Init,
    .nm_modname = "entry",
    .nm_priv = ((void*)0),
    .reserved = { 0 },
};

extern "C" __attribute__((constructor)) void RegisterEntryModule(void)
{
    napi_module_register(&amp;demoModule);
}</code></pre><p><strong>å…³é”®ä»£ç è¯´æ˜</strong>ï¼š</p><ul><li><code>MainArkUIViewController</code>: æ¡¥æ¥å‡½æ•°ï¼Œè°ƒç”¨Kotlinå¯¼å‡ºçš„åŒåå‡½æ•°</li><li><code>InitResourceManager</code>: åˆå§‹åŒ–èµ„æºç®¡ç†å™¨ï¼Œä¼ é€’ç»™Kotlinå±‚</li><li><code>libkn_symbols()</code>: è®¿é—®Kotlin/Nativeå¯¼å‡ºçš„ç¬¦å·</li></ul></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>5.5 åˆ›å»ºArkTSé¡µé¢</h2>
          <span>19 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">5.5.1 åˆ›å»ºComposeInterops.ets é¦–å…ˆåˆ›å»º harmonyApp/entry/src/main/ets/pages/ComposeInterops.et...</p>
        <ul class="points"><li>5.5.1 åˆ›å»ºComposeInterops.ets</li><li>é¦–å…ˆåˆ›å»º harmonyApp/entry/src/main/ets/pages/ComposeInterops.etsï¼Œå®ç°ArkUIä¸Composeäº’æ“ä½œç»„ä»¶ï¼š</li><li>typescript</li><li>import { promptAction } from &#x27;@kit.ArkUI&#x27;;</li></ul>
        <div class="content rich"><h4>5.5.1 åˆ›å»ºComposeInterops.ets</h4><p>é¦–å…ˆåˆ›å»º <code>harmonyApp/entry/src/main/ets/pages/ComposeInterops.ets</code>ï¼Œå®ç°ArkUIä¸Composeäº’æ“ä½œç»„ä»¶ï¼š</p><pre><code class="language-typescript">import { promptAction } from '@kit.ArkUI';

interface ButtonArgs {
  text: string
  backgroundColor: string
}

@Builder
export function buttonBuilder(args: ButtonArgs) {
  button()
}

@Component
export struct button {
  @Consume compose_args: ButtonArgs

  build() {
    Column() {
      Button(this.compose_args.text)
        .backgroundColor(this.compose_args.backgroundColor)
        .width('100%')
        .onClick(e =&gt; {
          console.log(`Button Clicked: ${this.compose_args.text}`)
        })
        .height('70%')

      Text(this.compose_args.text)
        .backgroundColor(this.compose_args.backgroundColor)
        .width('100%')
        .onClick(e =&gt; {
          console.log(`Text Clicked: ${this.compose_args.text}`)
        })
        .height('20%')
      Stack().height('10%')
    }
  }
}

interface TextArgs {
  id: string
  text: string
  backgroundColor: string
}

@Builder
export function textBuilder(args: TextArgs) {
  text()
}

@Component
export struct text {
  @Consume compose_args: TextArgs

  build() {
    Text(this.compose_args.id + " " + this.compose_args.text)
      .backgroundColor(this.compose_args.backgroundColor)
      .width('100%')
      .height('100%')
      .borderRadius('5vp')
      .onClick(e =&gt; {
        console.log(`Text Clicked: ${JSON.stringify(this.compose_args)}`)
      })
  }
}

@Builder
export function labelBuilder(args: ButtonArgs) {
  label()
}

@Component
export struct label {
  @Consume compose_args: ButtonArgs

  build() {
    Column() {
      Button(`+ ${this.compose_args.text}`, { type: ButtonType.Normal })
        .backgroundColor(this.compose_args.backgroundColor)
        .width('100%')
        .height('50%')
        .borderRadius(2)
        .onClick(e =&gt; {
          promptAction.showToast({
            message: this.compose_args.text
          })
        })
      Text(this.compose_args.text)
        .backgroundColor(Color.Orange)
        .width('100%')
        .height('50%')
    }
  }
}

@Builder
export function textInputBuilder(args: InputArgs) {
  textInput()
}

interface InputArgs {
  text: string
}

@Component
export struct textInput {
  @Consume compose_args: InputArgs

  build() {
    Column() {
      TextInput({ text: $$this.compose_args.text })
        .onChange(value =&gt; {
          console.log(`/// onChange: ${value}`)
        })

      Text("ArkUIç»„ä»¶æ›´æ–°:")
        .fontColor(Color.Gray)
        .margin({ top: 30 })

      Text(this.compose_args.text)
        .width('100%')
        .padding(10)
        .border({ width: 1, color: Color.Gray })
    }.alignItems(HorizontalAlign.Start)
  }
}

@Builder
export function layerBuilder(args: ButtonArgs) {
  layer()
}

@Component
export struct layer {
  @Consume compose_args: ButtonArgs

  build() {
    Stack({ alignContent: Alignment.BottomEnd }) {
      Text(this.compose_args.text)
    }
    .width('100%')
    .height('100%')
    .backgroundColor(this.compose_args.backgroundColor)
    .onClick(() =&gt; {
      promptAction.showToast({ message: `${this.compose_args.text} Clicked` })
    })
  }
}

@Builder
export function verticalListBuilder(args?: object) {
  verticalList()
}

@Component
export struct verticalList {
  build() {
    Row() {
      List() {
        ForEach([1, 2, 3, 4, 5, 6, 7, 8, 9, 10], (item: number, index) =&gt; {
          ListItem() {
            Button(`Ark Button ${index}`, { type: ButtonType.Normal })
              .borderRadius(2)
              .height('100vp')
              .padding(10)
          }.padding(10)
        })
      }.listDirection(Axis.Vertical).height('100%').width('40%')

      Stack().width('20%').height('100%').borderWidth(1)

      Scroll() {
        Column() {
          ForEach([1, 2, 3, 4, 5, 6, 7, 8, 9, 10], (item: number, index) =&gt; {
            ListItem() {
              Button(`Ark Button ${index}`, { type: ButtonType.Normal })
                .borderRadius(2)
                .height('100vp')
                .padding(10)
            }.padding(10)
          })
        }
      }.scrollable(ScrollDirection.Vertical).height('100%').width('40%')
    }
  }
}

@Builder
export function horizontalListBuilder(args?: object) {
  horizontalList()
}

@Component
export struct horizontalList {
  build() {
    Column() {
      List() {
        ForEach([1, 2, 3, 4, 5, 6, 7, 8, 9, 10], (item: number, index) =&gt; {
          ListItem() {
            Button(`Ark Button ${index}`, { type: ButtonType.Normal })
              .borderRadius(2)
              .height('100vp')
          }.padding(10)
        })
      }.listDirection(Axis.Horizontal).height('40%').width('100%')

      Stack().width('100%').height('20%').borderWidth(1)

      Scroll() {
        Row() {
          ForEach([1, 2, 3, 4, 5, 6, 7, 8, 9, 10], (item: number, index) =&gt; {
            ListItem() {
              Button(`Ark Button ${index}`, { type: ButtonType.Normal })
                .borderRadius(2)
                .height('100vp')
            }.padding(10)
          })
        }
      }.scrollable(ScrollDirection.Horizontal).height('40%').width('100%')
    }
  }
}</code></pre><p><strong>å…³é”®ä»£ç è¯´æ˜</strong>ï¼š</p><ul><li><code>@Builder</code>: å®šä¹‰å¯å¤ç”¨çš„UIæ„å»ºå‡½æ•°</li><li><code>@Component</code>: å®šä¹‰ArkUIç»„ä»¶</li><li><code>@Consume</code>: ä»Composeä¼ é€’è¿‡æ¥çš„å‚æ•°</li><li>è¿™äº›ç»„ä»¶å…è®¸åœ¨Composeä¸­åµŒå…¥åŸç”ŸArkUIç»„ä»¶ï¼Œå®ç°äº’æ“ä½œ</li></ul><h4>5.5.2 åˆ›å»ºComposeSample.ets</h4><p>åˆ›å»º <code>harmonyApp/entry/src/main/ets/pages/ComposeSample.ets</code>ï¼š</p><pre><code class="language-typescript">import { registerComposeInteropBuilder } from 'compose/src/main/ets/compose/ArkUIView';
import {
  buttonBuilder,
  textBuilder,
  labelBuilder,
  textInputBuilder,
  buttonWrapContentBuilder,
  layerBuilder,
  verticalListBuilder,
  horizontalListBuilder,
} from './ComposeInterops';

export function registerComposeInteropBuilders() {
  registerComposeInteropBuilder('button', buttonBuilder)
  registerComposeInteropBuilder('label', labelBuilder)
  registerComposeInteropBuilder('buttonWrapContent', buttonWrapContentBuilder)
  registerComposeInteropBuilder('textInput', textInputBuilder)
  registerComposeInteropBuilder('layer', layerBuilder)
  registerComposeInteropBuilder('text', textBuilder)
  registerComposeInteropBuilder('verticalList', verticalListBuilder)
  registerComposeInteropBuilder('horizontalList', horizontalListBuilder)
}</code></pre><h4>5.5.3 åˆ›å»ºIndex.etså…¥å£é¡µé¢</h4><p>åˆ›å»º <code>harmonyApp/entry/src/main/ets/pages/Index.ets</code>ï¼š</p><pre><code class="language-typescript">import { Compose } from 'compose';
import { MainArkUIViewController } from 'libentry.so';
import { registerComposeInteropBuilders } from './ComposeSample';

registerComposeInteropBuilders();

@Entry
@Component
struct Index {
  private controller = MainArkUIViewController()

  onPageShow(): void {
    this.controller.onPageShow()
  }

  onPageHide(): void {
    this.controller.onPageHide()
  }

  onBackPress(): boolean | void {
    // è¿”å›äº‹ä»¶è½¬å‘ç»™ Composeï¼Œä¼˜å…ˆç»™ Compose æ¶ˆè´¹ï¼Œè‹¥ Compose ä¸æ¶ˆè´¹å†ç»™ç³»ç»Ÿæ¶ˆè´¹
    return this.controller.onBackPress()
  }

  build() {
    Stack() {
      Compose(
        {
          controller: this.controller,
          libraryName: "entry",
          // è‹¥ Compose ä¸æ¶ˆè´¹ï¼Œäº‹ä»¶ä¼šæµè½¬åˆ°è¿™é‡Œï¼Œè‹¥è¿™é‡Œè¿”å› falseï¼Œåˆ™äº¤ç”±ç³»ç»Ÿå¤„ç†
          onBackPressed: () =&gt; false
        }
      ).width('100%').height('100%')
    }.width('100%').height('100%')
  }
}</code></pre><p><strong>å…³é”®ä»£ç è¯´æ˜</strong>ï¼š</p><ul><li><code>MainArkUIViewController()</code>: è°ƒç”¨NAPIå¯¼å‡ºçš„å‡½æ•°ï¼Œåˆ›å»ºComposeæ§åˆ¶å™¨</li><li><code>registerComposeInteropBuilders()</code>: æ³¨å†ŒArkUIä¸Composeäº’æ“ä½œç»„ä»¶</li><li><code>Compose</code>: é¸¿è’™Composeç»„ä»¶ï¼Œæ‰¿è½½Kotlinç¼–å†™çš„Compose UI</li><li>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼š<code>onPageShow</code>, <code>onPageHide</code>, <code>onBackPress</code></li></ul></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>6.1 ç¼–è¯‘KMPå…±äº«åº“</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">åœ¨KMPå·¥ç¨‹æ ¹ç›®å½•æ‰§è¡Œï¼š bash</p>
        <ul class="points"><li>åœ¨KMPå·¥ç¨‹æ ¹ç›®å½•æ‰§è¡Œï¼š</li><li>bash</li></ul>
        <div class="content rich"><p>åœ¨KMPå·¥ç¨‹æ ¹ç›®å½•æ‰§è¡Œï¼š</p><pre><code class="language-bash"></code></pre></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>Debugç‰ˆæœ¬</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">./gradlew publishDebugBinariesToHarmonyApp</p>
        <ul class="points"><li>./gradlew publishDebugBinariesToHarmonyApp</li></ul>
        <div class="content rich"><p>./gradlew publishDebugBinariesToHarmonyApp</p></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>Releaseç‰ˆæœ¬</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">./gradlew publishReleaseBinariesToHarmonyApp æ­¤å‘½ä»¤ä¼šï¼š ç¼–è¯‘é¸¿è’™å¹³å°çš„Kotlinä»£ç  ç”Ÿæˆ libkn.so å…±äº«åº“ ç”Ÿæˆ l...</p>
        <ul class="points"><li>./gradlew publishReleaseBinariesToHarmonyApp</li><li>æ­¤å‘½ä»¤ä¼šï¼š</li><li>ç¼–è¯‘é¸¿è’™å¹³å°çš„Kotlinä»£ç </li><li>ç”Ÿæˆ libkn.so å…±äº«åº“</li></ul>
        <div class="content rich"><p>./gradlew publishReleaseBinariesToHarmonyApp</p><pre><code>
æ­¤å‘½ä»¤ä¼šï¼š
1. ç¼–è¯‘é¸¿è’™å¹³å°çš„Kotlinä»£ç 
2. ç”Ÿæˆ `libkn.so` å…±äº«åº“
3. ç”Ÿæˆ `libkn_api.h` å¤´æ–‡ä»¶
4. è‡ªåŠ¨å¤åˆ¶åˆ° `harmonyApp/entry/libs/arm64-v8a/` ç›®å½•</code></pre></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>6.2 åœ¨DevEco Studioä¸­ç¼–è¯‘é¸¿è’™åº”ç”¨</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">ç”¨DevEco Studioæ‰“å¼€ harmonyApp ç›®å½• ç­‰å¾…ä¾èµ–åŒæ­¥å®Œæˆ ç‚¹å‡» **Build** -&gt; **Build Hap(s)/APP(s)** æˆ–ç›´æ¥ç‚¹å‡»è¿è¡Œ...</p>
        <ul class="points"><li>ç”¨DevEco Studioæ‰“å¼€ harmonyApp ç›®å½•</li><li>ç­‰å¾…ä¾èµ–åŒæ­¥å®Œæˆ</li><li>ç‚¹å‡» **Build** -&gt; **Build Hap(s)/APP(s)**</li><li>æˆ–ç›´æ¥ç‚¹å‡»è¿è¡ŒæŒ‰é’®éƒ¨ç½²åˆ°è®¾å¤‡/æ¨¡æ‹Ÿå™¨</li></ul>
        <div class="content rich"><ol><li>ç”¨DevEco Studioæ‰“å¼€ <code>harmonyApp</code> ç›®å½•</li><li>ç­‰å¾…ä¾èµ–åŒæ­¥å®Œæˆ</li><li>ç‚¹å‡» <strong>Build</strong> -&gt; <strong>Build Hap(s)/APP(s)</strong></li><li>æˆ–ç›´æ¥ç‚¹å‡»è¿è¡ŒæŒ‰é’®éƒ¨ç½²åˆ°è®¾å¤‡/æ¨¡æ‹Ÿå™¨</li></ol></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>6.3 éªŒè¯é›†æˆ</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">åº”ç”¨å¯åŠ¨åï¼Œåº”è¯¥èƒ½çœ‹åˆ°ï¼š Composeç¼–å†™çš„UIç•Œé¢æ­£å¸¸æ˜¾ç¤º æ˜¾ç¤ºæ–‡æœ¬: &quot;Compose: Hello, OHOS!&quot; ç•Œé¢å“åº”æ­£å¸¸</p>
        <ul class="points"><li>åº”ç”¨å¯åŠ¨åï¼Œåº”è¯¥èƒ½çœ‹åˆ°ï¼š</li><li>Composeç¼–å†™çš„UIç•Œé¢æ­£å¸¸æ˜¾ç¤º</li><li>æ˜¾ç¤ºæ–‡æœ¬: &quot;Compose: Hello, OHOS!&quot;</li><li>ç•Œé¢å“åº”æ­£å¸¸</li></ul>
        <div class="content rich"><p>åº”ç”¨å¯åŠ¨åï¼Œåº”è¯¥èƒ½çœ‹åˆ°ï¼š</p><ul><li>Composeç¼–å†™çš„UIç•Œé¢æ­£å¸¸æ˜¾ç¤º</li><li>æ˜¾ç¤ºæ–‡æœ¬: "Compose: Hello, OHOS!"</li><li>ç•Œé¢å“åº”æ­£å¸¸</li></ul></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>7.1 æ‰¾ä¸åˆ°libkn.so</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">**é—®é¢˜**: ç¼–è¯‘é¸¿è’™åº”ç”¨æ—¶æç¤ºæ‰¾ä¸åˆ°libkn.so **è§£å†³æ–¹æ¡ˆ**: ç¡®è®¤å·²æ‰§è¡Œ publishDebugBinariesToHarmonyApp ä»»åŠ¡ æ£€æŸ¥ har...</p>
        <ul class="points"><li>**é—®é¢˜**: ç¼–è¯‘é¸¿è’™åº”ç”¨æ—¶æç¤ºæ‰¾ä¸åˆ°libkn.so</li><li>**è§£å†³æ–¹æ¡ˆ**:</li><li>ç¡®è®¤å·²æ‰§è¡Œ publishDebugBinariesToHarmonyApp ä»»åŠ¡</li><li>æ£€æŸ¥ harmonyApp/entry/libs/arm64-v8a/libkn.so æ˜¯å¦å­˜åœ¨</li></ul>
        <div class="content rich"><p><strong>é—®é¢˜</strong>: ç¼–è¯‘é¸¿è’™åº”ç”¨æ—¶æç¤ºæ‰¾ä¸åˆ°libkn.so</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p><ol><li>ç¡®è®¤å·²æ‰§è¡Œ <code>publishDebugBinariesToHarmonyApp</code> ä»»åŠ¡</li><li>æ£€æŸ¥ <code>harmonyApp/entry/libs/arm64-v8a/libkn.so</code> æ˜¯å¦å­˜åœ¨</li><li>æ£€æŸ¥ CMakeLists.txt ä¸­çš„è·¯å¾„æ˜¯å¦æ­£ç¡®</li></ol></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>7.2 ç¬¦å·æœªå®šä¹‰</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">**é—®é¢˜**: é“¾æ¥æ—¶æç¤º undefined reference to MainArkUIViewController **è§£å†³æ–¹æ¡ˆ**: ç¡®è®¤ libkn_api.h å·²...</p>
        <ul class="points"><li>**é—®é¢˜**: é“¾æ¥æ—¶æç¤º undefined reference to MainArkUIViewController</li><li>**è§£å†³æ–¹æ¡ˆ**:</li><li>ç¡®è®¤ libkn_api.h å·²ç”Ÿæˆå¹¶å¤åˆ¶åˆ° harmonyApp/entry/src/main/cpp/include/</li><li>æ£€æŸ¥ Kotlin ä»£ç ä¸­çš„ @CName æ³¨è§£æ˜¯å¦æ­£ç¡®</li></ul>
        <div class="content rich"><p><strong>é—®é¢˜</strong>: é“¾æ¥æ—¶æç¤º <code>undefined reference to MainArkUIViewController</code></p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p><ol><li>ç¡®è®¤ <code>libkn_api.h</code> å·²ç”Ÿæˆå¹¶å¤åˆ¶åˆ° <code>harmonyApp/entry/src/main/cpp/include/</code></li><li>æ£€æŸ¥ Kotlin ä»£ç ä¸­çš„ <code>@CName</code> æ³¨è§£æ˜¯å¦æ­£ç¡®</li><li>é‡æ–°ç¼–è¯‘ KMP å…±äº«åº“</li></ol></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>7.3 èµ„æºåŠ è½½å¤±è´¥</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">**é—®é¢˜**: åº”ç”¨è¿è¡Œæ—¶æ— æ³•åŠ è½½Composeèµ„æº **è§£å†³æ–¹æ¡ˆ**: ç¡®è®¤å·²è°ƒç”¨ initResourceManager æ£€æŸ¥ napi_init.cpp ä¸­çš„èµ„æºç®¡ç†å™¨...</p>
        <ul class="points"><li>**é—®é¢˜**: åº”ç”¨è¿è¡Œæ—¶æ— æ³•åŠ è½½Composeèµ„æº</li><li>**è§£å†³æ–¹æ¡ˆ**:</li><li>ç¡®è®¤å·²è°ƒç”¨ initResourceManager</li><li>æ£€æŸ¥ napi_init.cpp ä¸­çš„èµ„æºç®¡ç†å™¨åˆå§‹åŒ–ä»£ç </li></ul>
        <div class="content rich"><p><strong>é—®é¢˜</strong>: åº”ç”¨è¿è¡Œæ—¶æ— æ³•åŠ è½½Composeèµ„æº</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p><ol><li>ç¡®è®¤å·²è°ƒç”¨ <code>initResourceManager</code></li><li>æ£€æŸ¥ <code>napi_init.cpp</code> ä¸­çš„èµ„æºç®¡ç†å™¨åˆå§‹åŒ–ä»£ç </li><li>ç¡®è®¤ <code>compose.har</code> ä¾èµ–å·²æ­£ç¡®é…ç½®</li></ol></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>7.4 ç‰ˆæœ¬ä¸å…¼å®¹</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">**é—®é¢˜**: ç¼–è¯‘æ—¶æç¤ºKotlinæˆ–Composeç‰ˆæœ¬ä¸å…¼å®¹ **è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨æŒ‡å®šçš„é¸¿è’™ç‰ˆæœ¬: kotlin: 2.2.0-ohos-07 compose-mul...</p>
        <ul class="points"><li>**é—®é¢˜**: ç¼–è¯‘æ—¶æç¤ºKotlinæˆ–Composeç‰ˆæœ¬ä¸å…¼å®¹</li><li>**è§£å†³æ–¹æ¡ˆ**:</li><li>ä½¿ç”¨æŒ‡å®šçš„é¸¿è’™ç‰ˆæœ¬:</li><li>kotlin: 2.2.0-ohos-07</li></ul>
        <div class="content rich"><p><strong>é—®é¢˜</strong>: ç¼–è¯‘æ—¶æç¤ºKotlinæˆ–Composeç‰ˆæœ¬ä¸å…¼å®¹</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p><ol><li>ä½¿ç”¨æŒ‡å®šçš„é¸¿è’™ç‰ˆæœ¬:<ul><li>kotlin: <code>2.2.0-ohos-07</code></li><li>compose-multiplatform: <code>1.6.1-ohos-003</code></li></ul></li><li>ç¡®è®¤ Maven ä»“åº“é…ç½®æ­£ç¡®</li><li>æ¸…ç†ç¼“å­˜: <code>./gradlew clean</code></li></ol></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>å…«ã€é¡¹ç›®ç»“æ„æ€»è§ˆ</h2>
          <span>3 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">MyKMPApp/ â”œâ”€â”€ composeApp/ # KMPåº”ç”¨æ¨¡å— â”‚ â”œâ”€â”€ build.gradle.kts # æ„å»ºé…ç½® â”‚ â””â”€â”€ src/ â”‚ â”œâ”€â”€ andr...</p>
        <ul class="points"><li>MyKMPApp/</li><li>â”œâ”€â”€ composeApp/ # KMPåº”ç”¨æ¨¡å—</li><li>â”‚ â”œâ”€â”€ build.gradle.kts # æ„å»ºé…ç½®</li><li>â”‚ â””â”€â”€ src/</li></ul>
        <div class="content rich"><pre><code>MyKMPApp/
â”œâ”€â”€ composeApp/                         # KMPåº”ç”¨æ¨¡å—
â”‚   â”œâ”€â”€ build.gradle.kts                # æ„å»ºé…ç½®
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ androidMain/                # Androidå¹³å°ä»£ç 
â”‚       â”œâ”€â”€ iosMain/                    # iOSå¹³å°ä»£ç 
â”‚       â”œâ”€â”€ commonMain/                 # å…±äº«ä»£ç 
â”‚       â”‚   â””â”€â”€ kotlin/
â”‚       â”‚       â””â”€â”€ com/example/mykmpapp/
â”‚       â”‚           â”œâ”€â”€ App.kt          # ä¸»UIç•Œé¢
â”‚       â”‚           â”œâ”€â”€ Greeting.kt     # ä¸šåŠ¡é€»è¾‘
â”‚       â”‚           â””â”€â”€ Platform.kt     # å¹³å°æ¥å£å®šä¹‰
â”‚       â””â”€â”€ ohosArm64Main/              # é¸¿è’™å¹³å°ä»£ç 
â”‚           â”œâ”€â”€ cinterop/               # Cäº’æ“ä½œé…ç½®
â”‚           â”‚   â”œâ”€â”€ include/
â”‚           â”‚   â”‚   â”œâ”€â”€ raw_file.h
â”‚           â”‚   â”‚   â””â”€â”€ raw_file_manager.h
â”‚           â”‚   â””â”€â”€ resource.def
â”‚           â””â”€â”€ kotlin/
â”‚               â””â”€â”€ com/example/mykmpapp/
â”‚                   â”œâ”€â”€ MainArkUIViewController.kt  # è§†å›¾æ§åˆ¶å™¨
â”‚                   â””â”€â”€ Platform.ohos.kt           # å¹³å°å®ç°
â”œâ”€â”€ harmonyApp/                         # é¸¿è’™åº”ç”¨å·¥ç¨‹
â”‚   â”œâ”€â”€ entry/
â”‚   â”‚   â”œâ”€â”€ libs/
â”‚   â”‚   â”‚   â”œâ”€â”€ arm64-v8a/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ libkn.so           # KMPç”Ÿæˆçš„å…±äº«åº“
â”‚   â”‚   â”‚   â””â”€â”€ compose.har            # Composeé¸¿è’™æ”¯æŒåº“
â”‚   â”‚   â”œâ”€â”€ src/main/
â”‚   â”‚   â”‚   â”œâ”€â”€ cpp/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ include/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ libkn_api.h    # KMPç”Ÿæˆçš„å¤´æ–‡ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CMakeLists.txt     # CMakeé…ç½®
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ napi_init.cpp      # NAPIæ¡¥æ¥ä»£ç 
â”‚   â”‚   â”‚   â””â”€â”€ ets/
â”‚   â”‚   â”‚       â””â”€â”€ pages/
â”‚   â”‚   â”‚           â”œâ”€â”€ Index.ets      # ä¸»é¡µé¢
â”‚   â”‚   â”‚           â””â”€â”€ ComposeSample.ets  # Composeäº’æ“ä½œé…ç½®
â”‚   â”‚   â””â”€â”€ oh-package.json5           # ä¾èµ–é…ç½®
â”‚   â””â”€â”€ build-profile.json5            # æ„å»ºé…ç½®
â”œâ”€â”€ gradle/
â”‚   â””â”€â”€ libs.versions.toml             # ç‰ˆæœ¬ç®¡ç†
â”œâ”€â”€ settings.gradle.kts                # å·¥ç¨‹è®¾ç½®
â””â”€â”€ build.gradle.kts                   # æ ¹æ„å»ºé…ç½®</code></pre></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>9.1 é…ç½®å¤šæ¨¡å—</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">å¦‚æœé¡¹ç›®æœ‰å¤šä¸ªå…±äº«æ¨¡å—ï¼Œå¯ä»¥åœ¨ settings.gradle.kts ä¸­æ·»åŠ ï¼š kotlin include(&quot;:composeApp&quot;) include(&quot;:shared...</p>
        <ul class="points"><li>å¦‚æœé¡¹ç›®æœ‰å¤šä¸ªå…±äº«æ¨¡å—ï¼Œå¯ä»¥åœ¨ settings.gradle.kts ä¸­æ·»åŠ ï¼š</li><li>kotlin</li><li>include(&quot;:composeApp&quot;)</li><li>include(&quot;:shared&quot;)</li></ul>
        <div class="content rich"><p>å¦‚æœé¡¹ç›®æœ‰å¤šä¸ªå…±äº«æ¨¡å—ï¼Œå¯ä»¥åœ¨ <code>settings.gradle.kts</code> ä¸­æ·»åŠ ï¼š</p><pre><code class="language-kotlin">include(":composeApp")
include(":shared")</code></pre></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>9.2 é…ç½®ç¬¦å·è¡¨</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">ä¸ºäº†ä¾¿äºè°ƒè¯•å´©æºƒï¼Œå¯ä»¥ä¿ç•™ç¬¦å·è¡¨ï¼š kotlin ohosArm64 { binaries.sharedLib { // åœ¨debugå’Œreleaseæ¨¡å¼ï¼Œè®©gradleéƒ½æ‰“...</p>
        <ul class="points"><li>ä¸ºäº†ä¾¿äºè°ƒè¯•å´©æºƒï¼Œå¯ä»¥ä¿ç•™ç¬¦å·è¡¨ï¼š</li><li>kotlin</li><li>ohosArm64 {</li><li>binaries.sharedLib {</li></ul>
        <div class="content rich"><p>ä¸ºäº†ä¾¿äºè°ƒè¯•å´©æºƒï¼Œå¯ä»¥ä¿ç•™ç¬¦å·è¡¨ï¼š</p><pre><code class="language-kotlin">ohosArm64 {
    binaries.sharedLib {
        // åœ¨debugå’Œreleaseæ¨¡å¼ï¼Œè®©gradleéƒ½æ‰“åŒ…å¸¦ç¬¦å·è¡¨çš„so
        debuggable = true
    }
}</code></pre></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>9.3 é…ç½®ProGuard/R8</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå¯ä»¥é…ç½®ä»£ç æ··æ·†å’Œä¼˜åŒ–ã€‚</p>
        <ul class="points"><li>å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå¯ä»¥é…ç½®ä»£ç æ··æ·†å’Œä¼˜åŒ–ã€‚</li></ul>
        <div class="content rich"><p>å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå¯ä»¥é…ç½®ä»£ç æ··æ·†å’Œä¼˜åŒ–ã€‚</p></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>åã€æ€»ç»“</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæ‚¨å·²ç»å®Œæˆäº†ï¼š âœ… åˆ›å»ºKMPå¤šå¹³å°å·¥ç¨‹ âœ… é…ç½®é¸¿è’™å¹³å°æ”¯æŒ âœ… åˆ›å»ºé¸¿è’™åº”ç”¨å·¥ç¨‹ âœ… å®ç°NAPIæ¡¥æ¥ âœ… é›†æˆCompose UI âœ… ç¼–è¯‘å’Œè¿è¡Œåº”ç”¨ ç°åœ¨...</p>
        <ul class="points"><li>é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæ‚¨å·²ç»å®Œæˆäº†ï¼š</li><li>âœ… åˆ›å»ºKMPå¤šå¹³å°å·¥ç¨‹</li><li>âœ… é…ç½®é¸¿è’™å¹³å°æ”¯æŒ</li><li>âœ… åˆ›å»ºé¸¿è’™åº”ç”¨å·¥ç¨‹</li></ul>
        <div class="content rich"><p>é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæ‚¨å·²ç»å®Œæˆäº†ï¼š</p><ol><li>âœ… åˆ›å»ºKMPå¤šå¹³å°å·¥ç¨‹</li><li>âœ… é…ç½®é¸¿è’™å¹³å°æ”¯æŒ</li><li>âœ… åˆ›å»ºé¸¿è’™åº”ç”¨å·¥ç¨‹</li><li>âœ… å®ç°NAPIæ¡¥æ¥</li><li>âœ… é›†æˆCompose UI</li><li>âœ… ç¼–è¯‘å’Œè¿è¡Œåº”ç”¨</li></ol><p>ç°åœ¨æ‚¨å¯ä»¥ï¼š</p><ul><li>åœ¨ <code>commonMain</code> ä¸­ç¼–å†™å…±äº«çš„ä¸šåŠ¡é€»è¾‘å’ŒUI</li><li>åœ¨ <code>ohosArm64Main</code> ä¸­ç¼–å†™é¸¿è’™å¹³å°ç‰¹å®šä»£ç </li><li>ä½¿ç”¨Composeæ„å»ºç°ä»£åŒ–çš„è·¨å¹³å°UI</li></ul></div>
      </section>
      <section class="section">
        <div class="section-head">
          <h2>åä¸€ã€å‚è€ƒèµ„æº</h2>
          <span>2 åˆ†é’Ÿ</span>
        </div>
        <p class="summary">Kotlin Multiplatform å®˜æ–¹æ–‡æ¡£ Compose Multiplatform å®˜æ–¹æ–‡æ¡£ HarmonyOS å¼€å‘è€…æ–‡æ¡£ --- **æœ€åæ›´æ–°**: 2025...</p>
        <ul class="points"><li>Kotlin Multiplatform å®˜æ–¹æ–‡æ¡£</li><li>Compose Multiplatform å®˜æ–¹æ–‡æ¡£</li><li>HarmonyOS å¼€å‘è€…æ–‡æ¡£</li><li>---</li></ul>
        <div class="content rich"><ul><li><a href="https://kotlinlang.org/docs/multiplatform.html" target="_blank" rel="noopener noreferrer">Kotlin Multiplatform å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://www.jetbrains.com/lp/compose-multiplatform/" target="_blank" rel="noopener noreferrer">Compose Multiplatform å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://developer.harmonyos.com/" target="_blank" rel="noopener noreferrer">HarmonyOS å¼€å‘è€…æ–‡æ¡£</a></li></ul><hr /><p><strong>æœ€åæ›´æ–°</strong>: 2025å¹´11æœˆ18æ—¥</p></div>
      </section>
  </main>
  </div>

  <div class="img-modal" id="img-modal" aria-hidden="true">
    <div class="img-modal-backdrop"></div>
    <div class="img-modal-toolbar">
      <button type="button" id="img-zoom-out" title="ç¼©å°">-</button>
      <button type="button" id="img-zoom-in" title="æ”¾å¤§">+</button>
      <button type="button" id="img-zoom-reset" title="é‡ç½®">100%</button>
      <span class="zoom-value" id="img-zoom-value">100%</span>
      <button type="button" id="img-modal-close" title="å…³é—­">å…³é—­</button>
    </div>
    <div class="img-modal-image-wrap">
      <img id="img-modal-img" alt="" />
    </div>
  </div>


  <script>
    (function () {
      const root = document.getElementById('zoom-root');
      if (!root) return;
      const valueEl = document.getElementById('zoom-value');
      const min = 0.6;
      const max = 2.4;
      const step = 0.1;
      const key = "km_detail_zoom";
      let scale = 1;

      try {
        const saved = parseFloat(localStorage.getItem(key) || "1");
        if (!Number.isNaN(saved)) scale = saved;
      } catch (_) {}

      const clamp = (n) => Math.min(max, Math.max(min, n));

      const apply = () => {
        scale = clamp(scale);
        if ("zoom" in root.style) {
          root.style.zoom = String(scale);
        } else {
          root.style.transform = `scale(${scale})`;
          root.style.transformOrigin = "top center";
        }
        if (valueEl) valueEl.textContent = `${Math.round(scale * 100)}%`;
        try {
          localStorage.setItem(key, String(scale));
        } catch (_) {}
      };

      document.querySelectorAll("[data-zoom]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const action = btn.getAttribute("data-zoom");
          if (action === "in") scale += step;
          if (action === "out") scale -= step;
          if (action === "reset") scale = 1;
          apply();
        });
      });

      window.addEventListener(
        "wheel",
        (event) => {
          if (!(event.ctrlKey || event.metaKey)) return;
          if (document.body.classList.contains("img-modal-open")) return;
          event.preventDefault();
          scale += event.deltaY < 0 ? step : -step;
          apply();
        },
        { passive: false }
      );

      window.addEventListener("keydown", (event) => {
        if (!(event.ctrlKey || event.metaKey)) return;
        if (event.key === "+" || event.key === "=") {
          event.preventDefault();
          scale += step;
          apply();
        } else if (event.key === "-") {
          event.preventDefault();
          scale -= step;
          apply();
        } else if (event.key === "0") {
          event.preventDefault();
          scale = 1;
          apply();
        }
      });

      apply();
    })();
  </script>


  <script>
    (function () {
      const modal = document.getElementById("img-modal");
      if (!modal) return;
      const image = document.getElementById("img-modal-img");
      const imageWrap = modal.querySelector(".img-modal-image-wrap");
      const closeBtn = document.getElementById("img-modal-close");
      const zoomOutBtn = document.getElementById("img-zoom-out");
      const zoomInBtn = document.getElementById("img-zoom-in");
      const zoomResetBtn = document.getElementById("img-zoom-reset");
      const zoomValue = document.getElementById("img-zoom-value");
      if (!image || !imageWrap) return;

      let scale = 1;
      const min = 0.2;
      const max = 6;
      const step = 0.15;
      let isDragging = false;
      let dragPointerId = null;
      let lastX = 0;
      let lastY = 0;

      const apply = () => {
        scale = Math.min(max, Math.max(min, scale));
        image.style.transform = `scale(${scale})`;
        if (zoomValue) zoomValue.textContent = `${Math.round(scale * 100)}%`;
      };

      const open = (src, alt) => {
        image.src = src;
        image.alt = alt || "";
        scale = 1;
        apply();
        imageWrap.scrollLeft = 0;
        imageWrap.scrollTop = 0;
        modal.classList.add("open");
        document.body.classList.add("img-modal-open");
        document.body.style.overflow = "hidden";
      };

      const stopDragging = () => {
        isDragging = false;
        dragPointerId = null;
        imageWrap.classList.remove("dragging");
      };

      const close = () => {
        stopDragging();
        modal.classList.remove("open");
        document.body.classList.remove("img-modal-open");
        document.body.style.overflow = "";
        image.removeAttribute("src");
      };

      document.querySelectorAll(".doc-figure img").forEach((img) => {
        const figure = img.closest(".doc-figure");
        const originSrc = img.getAttribute("data-origin-src") || img.src;

        const markFailed = () => {
          if (!figure) return;
          figure.classList.add("img-load-failed");
          const link = figure.querySelector(".img-open-link");
          if (link && !link.getAttribute("href")) {
            link.setAttribute("href", originSrc);
          }
        };

        img.addEventListener("error", () => {
          if (img.dataset.retriedNoQuery !== "1") {
            const noQuery = originSrc.split("?")[0];
            if (noQuery && noQuery !== originSrc) {
              img.dataset.retriedNoQuery = "1";
              img.src = noQuery;
              return;
            }
          }
          markFailed();
        });

        if (img.complete && img.naturalWidth === 0) {
          markFailed();
        }

        img.addEventListener("click", () => {
          if (img.naturalWidth > 0) {
            open(img.currentSrc || img.src, img.alt);
            return;
          }
          if (originSrc && originSrc !== "#") {
            window.open(originSrc, "_blank", "noopener,noreferrer");
          }
        });
      });

      closeBtn?.addEventListener("click", close);
      modal.addEventListener("click", (event) => {
        if (event.target === modal || event.target.classList.contains("img-modal-backdrop")) {
          close();
        }
      });

      zoomInBtn?.addEventListener("click", () => { scale += step; apply(); });
      zoomOutBtn?.addEventListener("click", () => { scale -= step; apply(); });
      zoomResetBtn?.addEventListener("click", () => { scale = 1; apply(); });

      imageWrap.addEventListener("pointerdown", (event) => {
        if (!modal.classList.contains("open")) return;
        if (event.button !== 0) return;
        isDragging = true;
        dragPointerId = event.pointerId;
        lastX = event.clientX;
        lastY = event.clientY;
        imageWrap.classList.add("dragging");
        imageWrap.setPointerCapture?.(event.pointerId);
        event.preventDefault();
      });

      imageWrap.addEventListener("pointermove", (event) => {
        if (!isDragging || event.pointerId !== dragPointerId) return;
        const dx = event.clientX - lastX;
        const dy = event.clientY - lastY;
        imageWrap.scrollLeft -= dx;
        imageWrap.scrollTop -= dy;
        lastX = event.clientX;
        lastY = event.clientY;
      });

      const onPointerDone = (event) => {
        if (event.pointerId !== dragPointerId) return;
        imageWrap.releasePointerCapture?.(event.pointerId);
        stopDragging();
      };

      imageWrap.addEventListener("pointerup", onPointerDone);
      imageWrap.addEventListener("pointercancel", onPointerDone);

      modal.addEventListener(
        "wheel",
        (event) => {
          if (!modal.classList.contains("open")) return;
          event.preventDefault();
          scale += event.deltaY < 0 ? step : -step;
          apply();
        },
        { passive: false }
      );

      window.addEventListener("keydown", (event) => {
        if (!modal.classList.contains("open")) return;
        if (event.key === "Escape") {
          close();
        } else if (event.key === "+" || event.key === "=") {
          event.preventDefault();
          scale += step;
          apply();
        } else if (event.key === "-") {
          event.preventDefault();
          scale -= step;
          apply();
        } else if (event.key === "0") {
          event.preventDefault();
          scale = 1;
          apply();
        }
      });
    })();
  </script>


  <script>
    (function () {
      const roots = document.querySelectorAll(".content.rich");
      if (!roots.length) return;

      const h3Pattern = /^(?:[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]+[ã€.ï¼]|\d+[ã€.ï¼)])\s*/;
      const h4Pattern = /^\d+\.\d+\s*/;
      const shortTitlePattern = /(?:æµç¨‹|æ­¥éª¤|è¯´æ˜|é…ç½®|å‘½ä»¤|ç›®å½•|è¦æ±‚|æ¦‚è§ˆ)$/;
      const bulletPattern = /^[-*â€¢]\s+/;
      const numberItemPattern = /^\d+[.)ã€]\s+/;

      const commandPattern =
        /^(?:\$\s*)?(?:export|git|ohpm|npm|pnpm|yarn|npx|python|python3|java|javac|gradle|\.\/gradlew|\.\/|adb|hdc|cmake|make|brew|curl|wget|source|chmod|chown|cp|mv|ls|cat|echo)\b/i;
      const envAssignPattern = /^(?:[A-Z_][A-Z0-9_]*=|PATH=|JAVA_HOME=|ANDROID_HOME=)/;
      const pathLikePattern = /(?:^\/|^\.\/|https?:\/\/|[\w.-]+\/[\w./-]+)/;

      const esc = (value) => {
        const span = document.createElement("span");
        span.textContent = value;
        return span.innerHTML;
      };

      const isCommandLike = (text) => {
        const sample = text.trim();
        if (!sample) return false;
        if (sample.length > 220) return false;
        if (commandPattern.test(sample)) return true;
        if (envAssignPattern.test(sample)) return true;
        if (sample.includes(" && ") || sample.includes(" || ")) return true;
        if (pathLikePattern.test(sample) && /\b(?:build|publish|clone|install|run|export|gradle|script)\b/i.test(sample)) {
          return true;
        }
        return false;
      };

      roots.forEach((root) => {
        const children = Array.from(root.children);
        const rebuilt = [];
        let codeBuffer = [];

        const flushCode = () => {
          if (!codeBuffer.length) return;
          const pre = document.createElement("pre");
          pre.className = "auto-code";
          const code = document.createElement("code");
          code.textContent = codeBuffer.join("\n");
          pre.appendChild(code);
          rebuilt.push(pre);
          codeBuffer = [];
        };

        children.forEach((node) => {
          if (node.tagName !== "P") {
            flushCode();
            rebuilt.push(node);
            return;
          }

          const text = (node.textContent || "").replace(/\u00A0/g, " ").trim();
          if (!text) return;

          if (h3Pattern.test(text)) {
            flushCode();
            const h3 = document.createElement("h3");
            h3.className = "auto-h3";
            h3.textContent = text;
            rebuilt.push(h3);
            return;
          }

          if (h4Pattern.test(text) || (text.length <= 24 && shortTitlePattern.test(text))) {
            flushCode();
            const h4 = document.createElement("h4");
            h4.className = "auto-h4";
            h4.textContent = text;
            rebuilt.push(h4);
            return;
          }

          const keyValue = text.match(/^([^:ï¼š]{2,20}[ï¼š:])\s*(.+)$/);
          if (keyValue) {
            const key = keyValue[1].trim();
            const value = keyValue[2].trim();
            if (value && isCommandLike(value)) {
              flushCode();
              const row = document.createElement("p");
              row.className = "kv-row";
              row.innerHTML = `<span class="kv-key">${esc(key)}</span><code>${esc(value)}</code>`;
              rebuilt.push(row);
              return;
            }
            if (value && value.length <= 120) {
              flushCode();
              const row = document.createElement("p");
              row.className = "kv-row";
              row.innerHTML = `<span class="kv-key">${esc(key)}</span><span>${esc(value)}</span>`;
              rebuilt.push(row);
              return;
            }
          }

          if (isCommandLike(text)) {
            codeBuffer.push(text);
            return;
          }

          if (bulletPattern.test(text) || numberItemPattern.test(text)) {
            flushCode();
            rebuilt.push(node);
            return;
          }

          flushCode();
          rebuilt.push(node);
        });

        flushCode();
        root.replaceChildren(...rebuilt);
      });
    })();
  </script>

  <script>
    (() => {
      const back = document.getElementById("chapter-back-link");
      if (!back) return;
      const chapter = (new URLSearchParams(window.location.search).get("chapter") || "all").trim().toLowerCase();
      if (!/^[a-z0-9-]+$/.test(chapter) || chapter === "all") {
        back.href = "../knowledge-map-chapters.html";
        return;
      }
      back.href = `../knowledge-map-chapters-${chapter}.html`;
    })();
  </script>
</body>
</html>
